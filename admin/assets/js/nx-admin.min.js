!function(l){"use strict";l.notificationx=l.notificationx||{},l(document).ready(function(){l.notificationx.init(),l("body").on("click",".nx-metatab-menu li, .nx-builder-tab-menu li, .nx-meta-next, .nx-quick-builder-btn",function(t){t.preventDefault(),l.notificationx.tabChanger(this)})}),l(window).load(function(){l("body").on("change","#nx_meta_display_type",function(){l.notificationx.linkOptions(this),"conversions"==l(this).val()&&l("#nx_meta_conversion_from").trigger("change")}),l("body").on("change","#nx_meta_display_type.nx-select",function(t){var i=l(this).val(),n=t.currentTarget.selectedOptions[0].innerText,e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});"conversions"===i?(l("body").on("change","#nx_meta_conversion_from.nx-select",function(t){l(this).val();var i=t.currentTarget.selectedOptions[0].innerText;l(".finalize_notificationx_name").text("NotificationX - "+i+" - "+e)}),l("#nx_meta_conversion_from.nx-select").trigger("change")):l(".finalize_notificationx_name").text("NotificationX - "+n+" - "+e)}),l("#nx_meta_display_type").trigger("change")}),l.notificationx.init=function(){l.notificationx.enabledDisabled(),l.notificationx.toggleFields(),l.notificationx.bindEvents(),l.notificationx.initializeFields()},l.notificationx.bindEvents=function(){l("body").on("click",".nx-single-theme-wrapper",function(){l.notificationx.selectTheme(this)}),l("body").delegate(".nx-group-field .nx-group-field-title","click",function(t){t.preventDefault(),l(t.srcElement).hasClass("nx-group-field-title")&&l.notificationx.groupToggle(this)}),l("body").delegate(".nx-group-field .nx-group-clone","click",function(){l.notificationx.cloneGroup(this)}),l("body").delegate(".nx-group-field .nx-group-remove","click",function(){l.notificationx.removeGroup(this)}),l("body").delegate(".nx-media-field-wrapper .nx-media-upload-button","click",function(t){t.preventDefault(),l.notificationx.initMediaField(this)}),l("body").delegate(".nx-media-field-wrapper .nx-media-remove-button","click",function(t){t.preventDefault(),l.notificationx.removeMedia(this)}),l("body").delegate(".nx-settings-menu li","click",function(t){l.notificationx.settingsTab(this)}),l("body").delegate(".nx-submit-general","click",function(t){t.preventDefault(),l.notificationx.submitSettings(this)}),l("body").delegate(".nx-opt-alert","click",function(t){l.notificationx.fieldAlert(this)})},l.notificationx.enabledDisabled=function(){l(".wp-list-table .column-notification_status img").off("click").on("click",function(t){t.stopPropagation();var i=l(this),n=0<=i.attr("src").indexOf("active1.png"),e=i.data("post"),a=i.data("nonce");n?(i.attr("src",i.attr("src").replace("active1.png","active0.png")),i.attr("title","Inactive").attr("alt","Inactive")):(i.attr("src",i.attr("src").replace("active0.png","active1.png")),i.attr("title","Active").attr("alt","Active")),l.ajax({type:"post",url:window.ajaxurl,data:{action:"notifications_toggle_status",post_id:e,nonce:a,status:n?"inactive":"active"},success:function(t){"success"!==t&&(alert(t),(n=0<=i.attr("src").indexOf("active1.png"))?(i.attr("src",i.attr("src").replace("active1.png","active0.png")),i.attr("title","Inactive").attr("alt","Inactive")):(i.attr("src",i.attr("src").replace("active0.png","active1.png")),i.attr("title","Active").attr("alt","Active")))}})})},l.notificationx.initializeFields=function(){0<l(".nx-meta-field").length&&l(".nx-meta-field").map(function(t,i){"SELECT"===i.nodeName&&l(i).select2()}),0<l(".nx-countdown-datepicker").length&&l(".nx-countdown-datepicker").each(function(){l(this).find("input").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"DD, d MM, yy"})}),l(".notificationx-metabox-wrapper .nx-meta-field:not(#nx_meta_conversion_from)").trigger("change"),0<l(".nx-colorpicker-field").length&&void 0!==l.fn.wpColorPicker&&l(".nx-colorpicker-field").each(function(){var t=l(this).val();l(this).wpColorPicker({change:function(t,i){var n=t.target,e=i.color.toString();l(n).parents(".wp-picker-container").find("input.nx-colorpicker-field").val(e).trigger("change")}}).parents(".wp-picker-container").find(".wp-color-result").css("background-color","#"+t)}),l.notificationx.groupField(),l.notificationx.template(),l(".nx-meta-template-editable").trigger("blur")},l.notificationx.groupField=function(){l(".nx-group-field-wrapper").length<0||l(".nx-group-field-wrapper").each(function(){var c=l(this),t=c.find(".nx-group-field");c.find(".nx-group-field:first"),c.find(".nx-group-field:last");t.each(function(){var t=l(this).find(".nx-group-field-title:not(.open)").next();t.is(":visible")&&t.addClass("open")}),c.find(".nx-group-field-add").on("click",function(t){t.preventDefault();var i=c.attr("id"),e=c.data("name"),n=(c.find(".nx-group-fields-wrapper"),c.find(".nx-group-field")),a=(c.find(".nx-group-field:first"),c.find(".nx-group-field:last")),o=l(c.find(".nx-group-template").html()),r=parseInt(a.data("id"))+1;o.data("group-title");n.each(function(){l(this).removeClass("open")}),o.attr("data-id",r),o.addClass("open"),o.find("tr.nx-field[id*="+i+"]").each(function(){var t=e,i=l(this).attr("id").split("[1]")[1],n=t+"["+r+"]"+i,a=l(this).find("th label");l(this).find('[name*="'+t+'[1]"]').each(function(){var t=l(this).attr("name").split("[1]"),i=t[0],n=t[1],e=i+"["+r+"]"+n;l(this).attr("id",e).attr("name",e),a.attr("for",e)}),l(this).attr("id",n)}),o.insertBefore(l(this))})})},l.notificationx.tabChanger=function(t){var i,n=l(t),e=n.data("tabid"),a=n.data("tab");if(""!=a&&(i=l("#nx-"+a),l("#nx_builder_current_tab").val(a)),"BUTTON"!==t.nodeName)return n.parent().find("li").each(function(t){t<e?l(this).addClass("nx-complete"):l(this).removeClass("nx-complete")}),n.addClass("active").siblings().removeClass("active"),void i.addClass("active").siblings().removeClass("active");void 0!==i?(l('.nx-metatab-menu li[data-tabid="'+e+'"]').trigger("click"),l('.nx-builder-tab-menu li[data-tabid="'+e+'"]').trigger("click")):l("#publish").trigger("click")},l.notificationx.toggleFields=function(){l("body").delegate(".nx-meta-field","change",function(t){l.notificationx.checkDependencies(this)})},l.notificationx.toggle=function(t,i,n,e){var a=0;if(e=void 0===e?"":e,void 0!==t)for(;a<t.length;a++)l(n+t[a]+e)[i]()},l.notificationx.checkDependencies=function(t){if(null!==notificationx.toggleFields){var i=l(t),n=i.parents(".nx-field:first").data("id"),e=i.val();if("checkbox"===i.attr("type")&&(e=i.is(":checked")?1:0),i.hasClass("nx-theme-selected")){var a=i.parents(".nx-theme-control-wrapper").data("name");e=l("#"+a).val()}if(notificationx.toggleFields.hasOwnProperty(n)){var o=notificationx.toggleFields[n].hasOwnProperty(e);if(notificationx.toggleFields.hasOwnProperty(n)&&l.each(notificationx.toggleFields[n],function(t,i){l.notificationx.toggle(i.fields,"hide","#nx-meta-","",n),l.notificationx.toggle(i.sections,"hide","#nx-meta-section-","",n)}),o&&(l.notificationx.toggle(notificationx.toggleFields[n][e].fields,"show","#nx-meta-","",n),l.notificationx.toggle(notificationx.toggleFields[n][e].sections,"show","#nx-meta-section-","",n)),notificationx.hideFields.hasOwnProperty(n)){var r=notificationx.hideFields[n];r.hasOwnProperty(e)&&(l.notificationx.toggle(r[e].fields,"hide","#nx-meta-","",n),l.notificationx.toggle(r[e].sections,"hide","#nx-meta-section-","",n))}}}},l.notificationx.selectTheme=function(t){var i=l(t),n=i.find("img").data("theme"),e=l(i.parents(".nx-theme-control-wrapper")).data("name");i.addClass("nx-theme-selected").siblings().removeClass("nx-theme-selected"),l("#"+e).val(n),i.trigger("change")},l.notificationx.groupToggle=function(t){var i=l(t).parents(".nx-group-field");i.hasClass("open")?i.removeClass("open"):i.addClass("open").siblings().removeClass("open")},l.notificationx.removeGroup=function(t){var i=l(t).parents(".nx-group-field").data("id");l(t).parents('.nx-group-field[data-id="'+i+'"]').fadeOut({duration:300,complete:function(){l(this).remove()}})},l.notificationx.cloneGroup=function(t){var i=l(t).parents(".nx-group-field").data("id"),n=l(t).parents('.nx-group-field[data-id="'+i+'"]'),e=l(n.clone()),a=l(t).parents(".nx-group-fields-wrapper").find(".nx-group-field:last"),o=n.parent(),r=l(a).data("id")+1;e.attr("data-id",r),e.insertAfter(n),l.notificationx.resetFieldIds(o.find(".nx-group-field"))},l.notificationx.resetFieldIds=function(t){var a=1;t.each(function(){var t=l(this),e=t.data("field-name"),i="nx-"+e,n=t.find(".nx-group-field-info").data("info").group_sub_fields;t.data("id",a),n.forEach(function(n){t.find('tr.nx-field[id="nx-'+n.field_name+'"]').find('[name*="'+n.field_name+'"]').each(function(){var t=l(this).attr("name"),i=t.split(n.field_name)[0];void 0===i&&(i=""),t=t.replace(t,i+e+"["+a+"]["+n.original_name+"]"),l(this).attr("name",t).attr("id",t)}),t.find('tr.nx-field[id="nx-'+n.field_name+'"]').attr("id",i+"["+a+"]["+n.original_name+"]")}),a++})},l.notificationx.initMediaField=function(i){var t=(i=l(i)).parents(".nx-media-field-wrapper"),n=t.find(".nx-media-remove-button"),e=t.find(".nx-thumb-container"),a=t.find(".nx-media-id"),o=t.find(".nx-media-url"),r=wp.media({title:"Upload Photo",button:{text:"Use this photo"},multiple:!1});r.on("select",function(){var t=r.state().get("selection").first().toJSON();e.addClass("nx-has-thumb").append('<img src="'+t.url+'" alt="" style="max-width:100%;"/>'),a.val(t.id),o.val(t.url),i.addClass("hidden"),n.removeClass("hidden")}),r.open()},l.notificationx.removeMedia=function(t){var i=(t=l(t)).parents(".nx-media-field-wrapper"),n=i.find(".nx-media-upload-button"),e=i.find(".nx-has-thumb"),a=i.find(".nx-media-id"),o=i.find(".nx-media-url");e.removeClass("nx-has-thumb").find("img").remove(),o.val(""),a.val(""),t.addClass("hidden"),n.removeClass("hidden")},l.notificationx.fieldAlert=function(t){var i=document.createElement("p"),n=document.createElement("a");n.setAttribute("href","https://wpdeveloper.net/in/notificationx-pro"),n.innerText="Premium",n.style.color="red",i.innerHTML="You need to upgrade to the <strong>"+n.outerHTML+" </strong> Version to use this feature",swal({title:"Opps...",content:i,icon:"warning",buttons:[!1,"Close"],dangerMode:!0})},l.notificationx.settingsTab=function(t){var i=(t=l(t)).data("tab");t.addClass("active").siblings().removeClass("active"),l("#nx-"+i).addClass("active").siblings().removeClass("active")},l.notificationx.submitSettings=function(t){var i=(t=l(t)).data("key"),n=t.data("nonce"),e=t.parent("#nx-settings-general-form"),a=l(e).serializeArray();l.ajax({type:"POST",url:ajaxurl,data:{action:"nx_general_settings",key:i,nonce:n,form_data:a},success:function(t){"success"===t?swal({title:"Settings Saved!",text:"Click OK to continue",icon:"success",buttons:[!1,"Ok"]}):swal({title:"Settings Not Saved!",text:"Click OK to continue",icon:"success",buttons:[!1,"Ok"]})}})},l.notificationx.linkOptions=function(){var t=l("#nx_meta_display_type").val();if("conversions"==t){l("#nx_meta_conversion_from").val();l("#nx_meta_notx_url").val("product_page").trigger("change")}"comments"==t&&l("#nx_meta_notx_url").val("comment_url").trigger("change")},l.notificationx.template=function(t){l(".nx-meta-template-editable").prop("disabled",!0),l(".nx-meta-template-editable").on("blur",function(){var e,t,i=l(this),n=i[0].innerText.trim().split("\n"),a=[],o=i[0].nextElementSibling.children;null!=n&&n.forEach(function(n,t){if(""!=n){var i=n.match(/\{\{[^\s]*\}\}/g);l(o[t]).val(n),null!=i&&(i.forEach(function(t,i){e=0<i?e.replace(t,'<span style="color:red">'+t+"</span>"):n.replace(t,'<span style="color:red">'+t+"</span>")}),a.push(e))}}),t=a.join("<br>"),i.html(t)})}}(jQuery);